<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MiXL â€” Intelligent AI DJ</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #04040a;
  --surface: #0a0b14;
  --surface2: #0f1020;
  --border: #1a1d30;
  --accent1: #00e5ff;
  --accent2: #ff2060;
  --accent3: #aa44ff;
  --green: #00ff88;
  --yellow: #ffdd00;
  --text: #dde0ff;
  --muted: #555878;
  --glow1: rgba(0,229,255,0.18);
  --glow2: rgba(255,32,96,0.18);
  --glow3: rgba(170,68,255,0.18);
}
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Space Mono', monospace;
  min-height: 100vh;
  overflow-x: hidden;
}
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(0,229,255,0.025) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,229,255,0.025) 1px, transparent 1px);
  background-size: 44px 44px;
  pointer-events: none; z-index: 0;
}
body::after {
  content: '';
  position: fixed; inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px,
    rgba(0,0,0,0.04) 2px, rgba(0,0,0,0.04) 4px);
  pointer-events: none; z-index: 1;
}
.wrap { position: relative; z-index: 2; max-width: 1220px; margin: 0 auto; padding: 0 24px; }

/* Header */
header {
  padding: 28px 0 20px;
  display: flex; align-items: center; gap: 18px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 28px;
}
.logo-disc {
  width: 54px; height: 54px;
  border-radius: 50%;
  border: 2px solid var(--accent1);
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
  box-shadow: 0 0 24px var(--glow1);
  animation: huerot 8s linear infinite;
  flex-shrink: 0;
}
@keyframes huerot {
  0%   { border-color: var(--accent1); box-shadow: 0 0 24px var(--glow1); }
  33%  { border-color: var(--accent3); box-shadow: 0 0 24px var(--glow3); }
  66%  { border-color: var(--accent2); box-shadow: 0 0 24px var(--glow2); }
  100% { border-color: var(--accent1); box-shadow: 0 0 24px var(--glow1); }
}
.logo-text h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 1.9rem; font-weight: 900;
  letter-spacing: 0.12em;
  background: linear-gradient(125deg, var(--accent1), var(--accent3), var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.logo-text p { font-size: 0.62rem; color: var(--muted); letter-spacing: 0.22em; text-transform: uppercase; margin-top: 3px; }
.header-right { margin-left: auto; display: flex; gap: 6px; align-items: flex-end; }
.vu { width: 4px; background: var(--accent1); border-radius: 2px 2px 0 0;
  opacity: 0.6; animation: vu .5s ease-in-out infinite alternate; }
@keyframes vu { from { opacity: 0.2; } to { opacity: 1; } }

/* Layout */
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.full { grid-column: 1/-1; }

/* Cards */
.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 22px; position: relative; overflow: hidden;
}
.card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent1), transparent); opacity: 0.4;
}
.card-lbl {
  font-size: 0.58rem; letter-spacing: 0.26em; text-transform: uppercase;
  color: var(--accent1); margin-bottom: 14px;
  display: flex; align-items: center; gap: 8px;
}
.card-lbl::before {
  content: ''; width: 6px; height: 6px; border-radius: 50%;
  background: var(--accent1); box-shadow: 0 0 8px var(--accent1);
}

/* Drop zone */
.drop {
  border: 2px dashed var(--border); border-radius: 10px;
  padding: 36px 16px; text-align: center; cursor: pointer;
  transition: all .25s;
}
.drop:hover, .drop.over { border-color: var(--accent1); background: rgba(0,229,255,0.03); }
.drop.loaded { border-color: var(--accent3); border-style: solid; background: rgba(170,68,255,0.04); }
.drop-icon { font-size: 2.2rem; display: block; margin-bottom: 10px; }
.drop h3 { font-family: 'Orbitron', sans-serif; font-size: 0.78rem; letter-spacing: 0.1em; margin-bottom: 5px; }
.drop p { font-size: 0.62rem; color: var(--muted); }
input[type=file] { display: none; }

/* Track info */
.track-info { display: none; margin-top: 18px; }
.track-info.show { display: block; }
.track-name { font-family: 'Orbitron', sans-serif; font-size: 0.8rem; color: var(--accent3);
  letter-spacing: 0.04em; margin-bottom: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.metrics { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.metric { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 10px 13px; }
.metric-lbl { font-size: 0.52rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 3px; }
.metric-val { font-family: 'Orbitron', sans-serif; font-size: 1.15rem; font-weight: 700; color: var(--accent1); }
.metric-sub { font-size: 0.58rem; color: var(--muted); margin-top: 2px; }
.camelot-tag {
  display: inline-block; background: var(--accent3); color: #fff;
  font-family: 'Orbitron', sans-serif; font-size: 0.88rem; font-weight: 700;
  padding: 3px 10px; border-radius: 4px; box-shadow: 0 0 12px rgba(170,68,255,0.5);
}
.energy-bar { margin-top: 12px; height: 56px; background: var(--surface2);
  border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
.energy-bar canvas { width: 100%; height: 100%; }
.zone-info { font-size: 0.58rem; color: var(--muted); margin-top: 7px;
  display: flex; align-items: center; gap: 6px; }
.zone-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent3); flex-shrink: 0; }

/* Spectral pills */
.spectral-row { display: flex; gap: 6px; margin-top: 10px; flex-wrap: wrap; }
.spec-pill { font-size: 0.52rem; letter-spacing: 0.1em; padding: 3px 8px;
  border-radius: 20px; border: 1px solid var(--border); color: var(--muted);
  background: var(--surface2); }
.spec-pill span { color: var(--accent1); }

/* Compat panel */
.compat-row { display: flex; align-items: flex-start; gap: 24px; }
.ring-wrap { position: relative; width: 96px; height: 96px; flex-shrink: 0; }
.ring-wrap svg { transform: rotate(-90deg); }
.ring-bg { fill: none; stroke: var(--surface2); stroke-width: 8; }
.ring-fg { fill: none; stroke-width: 8; stroke-linecap: round; stroke: var(--accent1);
  transition: stroke-dashoffset 1.2s ease, stroke 0.5s ease; }
.ring-inner { position: absolute; inset: 0; display: flex; flex-direction: column;
  align-items: center; justify-content: center; }
.ring-num { font-family: 'Orbitron', sans-serif; font-size: 1.35rem; font-weight: 900; color: var(--accent1); line-height: 1; }
.ring-lbl { font-size: 0.48rem; color: var(--muted); letter-spacing: 0.12em; text-transform: uppercase; }
.compat-detail { flex: 1; }
.verdict { font-family: 'Orbitron', sans-serif; font-size: 0.9rem; font-weight: 700; margin-bottom: 12px; }
.bar-row { display: flex; align-items: center; gap: 9px; font-size: 0.58rem;
  color: var(--muted); letter-spacing: 0.08em; margin-bottom: 7px; }
.bar-lbl { width: 60px; }
.bar-track { flex: 1; height: 5px; background: var(--surface2); border-radius: 3px; overflow: hidden; }
.bar-fill { height: 100%; border-radius: 3px; transition: width 1s ease; }
.bar-val { width: 32px; text-align: right; color: var(--text); font-size: 0.6rem; }
.bpm-bridge { font-size: 0.58rem; color: var(--muted); margin-top: 10px; line-height: 1.7; }
.bpm-bridge strong { color: var(--text); }

/* AI Strategy Panel */
.strategy-panel { margin-top: 18px; }
.strategy-header {
  display: flex; align-items: center; gap: 12px; margin-bottom: 14px;
}
.strategy-icon { font-size: 2rem; }
.strategy-name { font-family: 'Orbitron', sans-serif; font-size: 1rem; font-weight: 700; }
.strategy-desc { font-size: 0.62rem; color: var(--muted); line-height: 1.8; margin-top: 3px; }
.strategy-badge {
  display: inline-block; font-size: 0.55rem; letter-spacing: 0.18em;
  text-transform: uppercase; padding: 3px 10px; border-radius: 20px;
  border: 1px solid; margin-bottom: 8px;
}

/* Reasoning log */
.reasoning-title { font-size: 0.58rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--muted); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
.reasoning-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.reason-list { display: flex; flex-direction: column; gap: 6px; }
.reason-item {
  font-size: 0.62rem; color: var(--muted); line-height: 1.6;
  display: flex; gap: 8px; padding: 7px 10px;
  background: var(--surface2); border: 1px solid var(--border); border-radius: 6px;
}
.reason-item.highlight { color: var(--text); border-color: var(--accent1);
  background: rgba(0,229,255,0.04); }
.reason-arrow { color: var(--accent1); flex-shrink: 0; }

/* Mods list */
.mods-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
.mod-tag {
  font-size: 0.55rem; letter-spacing: 0.12em; text-transform: uppercase;
  padding: 4px 10px; border-radius: 20px;
  background: rgba(170,68,255,0.1); border: 1px solid var(--accent3);
  color: var(--accent3);
}

/* Mix controls */
.mix-row { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
.mix-btn {
  font-family: 'Orbitron', sans-serif; font-size: 0.68rem; font-weight: 700;
  letter-spacing: 0.16em; text-transform: uppercase;
  padding: 13px 28px; border: none; border-radius: 8px; cursor: pointer;
  background: linear-gradient(135deg, var(--accent1), var(--accent3));
  color: #000; transition: all .2s;
}
.mix-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,229,255,0.35); }
.mix-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
.status-row { display: none; align-items: center; gap: 10px; margin-top: 14px; }
.status-row.show { display: flex; }
.spinner { width: 18px; height: 18px; border: 2px solid var(--border);
  border-top-color: var(--accent1); border-radius: 50%; animation: spin .7s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.status-txt { font-size: 0.62rem; color: var(--muted); letter-spacing: 0.08em; }

/* Live log */
.live-log { margin-top: 14px; max-height: 200px; overflow-y: auto;
  background: var(--surface2); border: 1px solid var(--border); border-radius: 8px;
  padding: 12px; display: none; }
.live-log.show { display: block; }
.log-line { font-size: 0.58rem; color: var(--muted); line-height: 2;
  border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 2px; }
.log-line.new { color: var(--accent1); }
.log-line::before { content: 'â€º  '; color: var(--accent3); }

/* Exec log (after mix) */
.exec-log { margin-top: 14px; }
.exec-log-title { font-size: 0.56rem; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--muted); margin-bottom: 8px; }
.exec-log-scroll { max-height: 160px; overflow-y: auto;
  background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; padding: 10px; }
.exec-line { font-size: 0.56rem; color: var(--muted); line-height: 2; }
.exec-line::before { content: '$ '; color: var(--accent3); }

/* Player */
.player-inner { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 18px; }
.player-title { font-family: 'Orbitron', sans-serif; font-size: 0.7rem; color: var(--accent1);
  letter-spacing: 0.08em; margin-bottom: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.player-row { display: flex; align-items: center; gap: 12px; }
.play-btn {
  width: 46px; height: 46px; border-radius: 50%;
  background: linear-gradient(135deg, var(--accent1), var(--accent3));
  border: none; cursor: pointer; font-size: 1.1rem;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 18px var(--glow1); transition: transform .2s; flex-shrink: 0;
}
.play-btn:hover { transform: scale(1.08); }
.prog-wrap { flex: 1; }
.prog-bar { width: 100%; height: 4px; background: var(--border); border-radius: 2px;
  margin-bottom: 5px; cursor: pointer; }
.prog-fill { height: 100%; background: linear-gradient(90deg, var(--accent1), var(--accent3));
  border-radius: 2px; width: 0%; transition: width .1s; }
.prog-times { display: flex; justify-content: space-between; font-size: 0.5rem;
  color: var(--muted); font-family: 'Orbitron', sans-serif; }
.dl-btn { font-size: 0.9rem; background: none; border: 1px solid var(--border);
  border-radius: 6px; color: var(--text); padding: 9px 13px; cursor: pointer;
  text-decoration: none; display: flex; align-items: center;
  transition: all .2s; }
.dl-btn:hover { border-color: var(--accent1); color: var(--accent1); }

/* Volume bar */
.volume-row {
  display: flex; align-items: center; gap: 10px;
  margin-top: 14px; padding-top: 14px;
  border-top: 1px solid var(--border);
}
.vol-icon {
  font-size: 1rem; cursor: pointer; flex-shrink: 0;
  width: 28px; text-align: center;
  transition: transform .15s;
  user-select: none;
}
.vol-icon:hover { transform: scale(1.2); }
.vol-label {
  font-size: 0.52rem; letter-spacing: 0.18em; text-transform: uppercase;
  color: var(--muted); flex-shrink: 0; width: 44px;
}
.vol-slider-wrap { flex: 1; position: relative; }
.vol-track {
  width: 100%; height: 5px; background: var(--border);
  border-radius: 3px; position: relative; cursor: pointer;
}
.vol-fill {
  height: 100%; border-radius: 3px;
  background: linear-gradient(90deg, var(--accent3), var(--accent1));
  transition: width .05s;
  box-shadow: 0 0 6px rgba(0,229,255,0.4);
}
.vol-thumb {
  position: absolute; top: 50%; transform: translate(-50%, -50%);
  width: 14px; height: 14px; border-radius: 50%;
  background: var(--accent1); box-shadow: 0 0 8px var(--accent1);
  cursor: grab; transition: transform .15s, box-shadow .15s;
  pointer-events: none;
}
.vol-thumb:active { cursor: grabbing; }
.vol-track:hover .vol-thumb {
  transform: translate(-50%, -50%) scale(1.3);
  box-shadow: 0 0 14px var(--accent1);
}
.vol-pct {
  font-family: 'Orbitron', sans-serif; font-size: 0.65rem;
  color: var(--accent1); min-width: 36px; text-align: right; flex-shrink: 0;
}

/* Volume bar */
.volume-row {
  display: flex; align-items: center; gap: 10px;
  margin-top: 14px; padding-top: 14px;
  border-top: 1px solid var(--border);
}
.vol-icon {
  font-size: 1.1rem; cursor: pointer; flex-shrink: 0;
  width: 28px; text-align: center;
  transition: transform .15s; user-select: none;
}
.vol-icon:hover { transform: scale(1.2); }
.vol-label { font-size: 0.52rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); flex-shrink: 0; width: 44px; }
.vol-slider-wrap { flex: 1; position: relative; }
.vol-track { width: 100%; height: 5px; background: var(--border); border-radius: 3px; position: relative; cursor: pointer; }
.vol-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, var(--accent3), var(--accent1)); width: 80%; box-shadow: 0 0 6px rgba(0,229,255,0.4); }
.vol-thumb {
  position: absolute; top: 50%; left: 80%;
  transform: translate(-50%, -50%);
  width: 14px; height: 14px; border-radius: 50%;
  background: var(--accent1); box-shadow: 0 0 8px var(--accent1);
  cursor: grab; pointer-events: none;
  transition: transform .15s, box-shadow .15s;
}
.vol-track:hover .vol-thumb { transform: translate(-50%,-50%) scale(1.35); box-shadow: 0 0 14px var(--accent1); }
.vol-pct { font-family: 'Orbitron', sans-serif; font-size: 0.65rem; color: var(--accent1); min-width: 36px; text-align: right; flex-shrink: 0; }

/* Result grid */
.result-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 10px; margin-top: 14px; }

/* Toast */
.toast { position: fixed; bottom: 24px; right: 24px;
  background: var(--surface); border: 1px solid var(--accent1);
  border-radius: 8px; padding: 13px 18px; font-size: 0.62rem;
  color: var(--text); box-shadow: 0 8px 32px rgba(0,229,255,0.2);
  transform: translateY(80px); opacity: 0; transition: all .3s; z-index: 100; max-width: 300px; }
.toast.show { transform: translateY(0); opacity: 1; }

/* Loading overlay */
.loading { display: none; position: absolute; inset: 0; background: rgba(4,4,10,0.85);
  align-items: center; justify-content: center; border-radius: 14px; z-index: 10;
  flex-direction: column; gap: 10px; font-size: 0.6rem; color: var(--muted); letter-spacing: 0.15em; }
.loading.show { display: flex; }

/* Fade animation */
.fade-up { animation: fadeUp .4s ease forwards; }
@keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

/* Scrollbar */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: var(--surface2); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* Section spacing */
.section { margin-bottom: 20px; }
</style>
</head>
<body>
<div class="wrap">

<header>
  <div class="logo-disc">ğŸ›ï¸</div>
  <div class="logo-text">
    <h1>MiXL</h1>
    <p>Intelligent AI DJ â€” Deep Listening Â· Strategy Â· Surgery</p>
  </div>
  <div class="header-right" id="vuMeters"></div>
</header>

<!-- TRACK UPLOAD ROW -->
<div class="grid2 section">

  <!-- Track A -->
  <div class="card" id="cardA">
    <div class="card-lbl">Track A</div>
    <div class="drop" id="dropA" onclick="document.getElementById('fileA').click()">
      <span class="drop-icon">ğŸ’¿</span>
      <h3>DROP TRACK A</h3>
      <p>WAV files Â· up to 100 MB</p>
    </div>
    <input type="file" id="fileA" accept=".wav">

    <div class="track-info" id="infoA">
      <div class="track-name" id="nameA"></div>
      <div class="metrics">
        <div class="metric"><div class="metric-lbl">BPM</div><div class="metric-val" id="bpmA">â€”</div><div class="metric-sub">Tempo</div></div>
        <div class="metric"><div class="metric-lbl">Key</div><div class="metric-val" id="keyA">â€”</div><div class="metric-sub" id="modeA">â€”</div></div>
        <div class="metric" style="grid-column:1/-1">
          <div class="metric-lbl">Camelot Wheel</div>
          <span class="camelot-tag" id="camelotA">â€”</span>
          <div class="metric-sub" id="durA" style="margin-top:8px">â€”</div>
        </div>
      </div>
      <div class="energy-bar"><canvas id="energyA"></canvas></div>
      <div class="zone-info" id="zoneA"></div>
      <div class="spectral-row" id="specA"></div>
    </div>
    <div class="loading" id="loadA"><div class="spinner"></div><span>ANALYZING TRACK A...</span></div>
  </div>

  <!-- Track B -->
  <div class="card" id="cardB">
    <div class="card-lbl">Track B</div>
    <div class="drop" id="dropB" onclick="document.getElementById('fileB').click()">
      <span class="drop-icon">ğŸ’¿</span>
      <h3>DROP TRACK B</h3>
      <p>WAV files Â· up to 100 MB</p>
    </div>
    <input type="file" id="fileB" accept=".wav">

    <div class="track-info" id="infoB">
      <div class="track-name" id="nameB"></div>
      <div class="metrics">
        <div class="metric"><div class="metric-lbl">BPM</div><div class="metric-val" id="bpmB">â€”</div><div class="metric-sub">Tempo</div></div>
        <div class="metric"><div class="metric-lbl">Key</div><div class="metric-val" id="keyB">â€”</div><div class="metric-sub" id="modeB">â€”</div></div>
        <div class="metric" style="grid-column:1/-1">
          <div class="metric-lbl">Camelot Wheel</div>
          <span class="camelot-tag" id="camelotB" style="background:var(--accent2)">â€”</span>
          <div class="metric-sub" id="durB" style="margin-top:8px">â€”</div>
        </div>
      </div>
      <div class="energy-bar"><canvas id="energyB"></canvas></div>
      <div class="zone-info" id="zoneB"></div>
      <div class="spectral-row" id="specB"></div>
    </div>
    <div class="loading" id="loadB"><div class="spinner"></div><span>ANALYZING TRACK B...</span></div>
  </div>

</div>

<!-- COMPATIBILITY + AI BRAIN (hidden until both loaded) -->
<div id="compatSection" style="display:none">
  <div class="card section fade-up">
    <div class="card-lbl">Compatibility Analysis</div>
    <div class="compat-row">
      <div class="ring-wrap">
        <svg viewBox="0 0 100 100" width="96" height="96">
          <circle class="ring-bg" cx="50" cy="50" r="40"/>
          <circle class="ring-fg" id="ringFg" cx="50" cy="50" r="40"
                  stroke-dasharray="251.2" stroke-dashoffset="251.2"/>
        </svg>
        <div class="ring-inner">
          <div class="ring-num" id="scoreNum">0</div>
          <div class="ring-lbl">Score</div>
        </div>
      </div>
      <div class="compat-detail">
        <div class="verdict" id="verdict">â€”</div>
        <div class="bar-row">
          <div class="bar-lbl">BPM Match</div>
          <div class="bar-track"><div class="bar-fill" id="barBpm" style="width:0%;background:var(--accent1)"></div></div>
          <div class="bar-val" id="barBpmV">â€”</div>
        </div>
        <div class="bar-row">
          <div class="bar-lbl">Harmonic</div>
          <div class="bar-track"><div class="bar-fill" id="barKey" style="width:0%;background:var(--accent3)"></div></div>
          <div class="bar-val" id="barKeyV">â€”</div>
        </div>
        <div class="bar-row">
          <div class="bar-lbl">Spectral</div>
          <div class="bar-track"><div class="bar-fill" id="barSpec" style="width:0%;background:var(--accent2)"></div></div>
          <div class="bar-val" id="barSpecV">â€”</div>
        </div>
        <div class="bpm-bridge" id="bpmBridge"></div>
      </div>
    </div>
  </div>
</div>

<!-- MIX ENGINE -->
<div id="mixSection" style="display:none">
  <div class="card section fade-up">
    <div class="card-lbl">AI Mix Engine</div>
    <div class="mix-row">
      <button class="mix-btn" id="mixBtn" onclick="startMix()">ğŸ§  GENERATE INTELLIGENT MIX</button>
    </div>
    <div class="status-row" id="statusRow">
      <div class="spinner"></div>
      <div class="status-txt" id="statusTxt">Initializing...</div>
    </div>
    <div class="live-log" id="liveLog"></div>
  </div>
</div>

<!-- AI STRATEGY RESULT (shown after mix) -->
<div id="strategySection" style="display:none">
  <div class="card section fade-up">
    <div class="card-lbl">AI DJ Decision</div>
    <div class="strategy-panel">
      <div class="strategy-header">
        <div class="strategy-icon" id="stratIcon"></div>
        <div>
          <div class="strategy-name" id="stratName"></div>
          <div class="strategy-desc" id="stratDesc"></div>
        </div>
      </div>

      <div id="modsRow" class="mods-row"></div>

      <div class="reasoning-title">AI Reasoning Chain</div>
      <div class="reason-list" id="reasonList"></div>

      <div class="exec-log" id="execLogSection" style="display:none">
        <div class="exec-log-title">Execution Log</div>
        <div class="exec-log-scroll" id="execLogScroll"></div>
      </div>
    </div>
  </div>
</div>

<!-- PLAYER -->
<div id="playerSection" style="display:none">
  <div class="card section fade-up">
    <div class="card-lbl">AI-Generated Mix â€” Ready to Play</div>
    <div class="player-inner">
      <div class="player-title" id="playerTitle">MiXL Mix</div>
      <div class="player-row">
        <button class="play-btn" id="playBtn" onclick="togglePlay()">â–¶</button>
        <div class="prog-wrap">
          <div class="prog-bar" id="progBar" onclick="seek(event)">
            <div class="prog-fill" id="progFill"></div>
          </div>
          <div class="prog-times">
            <span id="curTime">0:00</span>
            <span id="totTime">0:00</span>
          </div>
        </div>
        <a class="dl-btn" id="dlBtn" title="Download Mix">â¬‡</a>
      </div>

      <!-- Volume Bar -->
      <div class="volume-row">
        <div class="vol-icon" id="volIcon" onclick="toggleMute()" title="Click to mute/unmute">ğŸ”Š</div>
        <div class="vol-label">Volume</div>
        <div class="vol-slider-wrap">
          <div class="vol-track" id="volTrack">
            <div class="vol-fill" id="volFill" style="width:80%"></div>
            <div class="vol-thumb" id="volThumb" style="left:80%"></div>
          </div>
        </div>
        <div class="vol-pct" id="volPct">80%</div>
      </div>
    </div>
    <div class="result-grid" id="resultGrid"></div>
  </div>
</div>

</div><!-- /wrap -->

<div class="toast" id="toast"></div>
<audio id="audio" onended="onEnded()" ontimeupdate="onTime()"></audio>

<script>
// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const S = { a: null, b: null, job: null, poll: null };

// â”€â”€ VU Meters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  const c = document.getElementById('vuMeters');
  [70,45,85,55,90,38,72,50,80,42].forEach((h, i) => {
    const d = document.createElement('div');
    d.className = 'vu';
    d.style.cssText = `height:${h}%;animation-delay:${i*.08}s;animation-duration:${.38+Math.random()*.35}s`;
    c.appendChild(d);
  });
})();

// â”€â”€ Drag & Drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
['A','B'].forEach(L => {
  const zone = document.getElementById('drop' + L);
  const inp  = document.getElementById('file' + L);
  zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('over'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('over'));
  zone.addEventListener('drop', e => {
    e.preventDefault(); zone.classList.remove('over');
    const f = e.dataTransfer.files[0];
    if (f) upload(f, L);
  });
  inp.addEventListener('change', () => { if (inp.files[0]) upload(inp.files[0], L); });
});

async function upload(file, L) {
  if (!file.name.toLowerCase().endsWith('.wav')) { toast('âŒ WAV files only'); return; }
  document.getElementById('load' + L).classList.add('show');

  const fd = new FormData();
  fd.append('file', file);
  try {
    const res = await fetch('/api/upload', { method: 'POST', body: fd });
    const d = await res.json();
    if (d.success) {
      S[L.toLowerCase()] = d.track;
      renderTrack(L, d.track);
      checkBoth();
    } else {
      toast('âŒ ' + (d.error || 'Upload failed'));
    }
  } catch(e) { toast('âŒ ' + e.message); }
  finally { document.getElementById('load' + L).classList.remove('show'); }
}

function renderTrack(L, t) {
  const lo = L.toLowerCase();
  const zone = document.getElementById('drop' + L);
  zone.classList.add('loaded');
  zone.querySelector('h3').textContent = 'âœ… TRACK ' + L + ' LOADED';
  zone.querySelector('p').textContent = t.filename;

  document.getElementById('name' + L).textContent = t.filename;
  document.getElementById('bpm'    + L).textContent = t.bpm;
  document.getElementById('key'    + L).textContent = t.key;
  document.getElementById('mode'   + L).textContent = t.mode;
  document.getElementById('camelot'+ L).textContent = t.camelot;
  document.getElementById('dur'    + L).textContent = fmt(t.duration_sec) + '  Â·  ' + (t.sample_rate/1000).toFixed(1) + ' kHz';

  if (t.best_transition) {
    const bt = t.best_transition;
    document.getElementById('zone' + L).innerHTML =
      '<div class="zone-dot"></div>Breakdown: ' + fmt(bt.start_sec) + ' â†’ ' + fmt(bt.end_sec) + ' (' + bt.duration_sec + 's)';
  }

  // Spectral pills (if available from analyze)
  const specEl = document.getElementById('spec' + L);
  specEl.innerHTML = '';

  drawEnergy('energy' + L, t.energy_rms || [], t.transition_zones || []);
  document.getElementById('info' + L).classList.add('show', 'fade-up');
}

function drawEnergy(id, rms, zones) {
  const cv = document.getElementById(id);
  if (!cv || !rms.length) return;
  cv.width = cv.offsetWidth || 380;
  cv.height = cv.offsetHeight || 56;
  const ctx = cv.getContext('2d');
  const W = cv.width, H = cv.height;
  ctx.fillStyle = '#0f1020'; ctx.fillRect(0,0,W,H);

  zones.forEach(z => {
    const x1 = z.start_sec / rms.length * W;
    const x2 = z.end_sec / rms.length * W;
    ctx.fillStyle = 'rgba(170,68,255,0.13)';
    ctx.fillRect(x1, 0, x2 - x1, H);
  });

  const g = ctx.createLinearGradient(0, 0, 0, H);
  g.addColorStop(0, '#00e5ff'); g.addColorStop(1, 'rgba(0,229,255,0.07)');
  ctx.beginPath(); ctx.moveTo(0, H);
  rms.forEach((v, i) => {
    const x = i / (rms.length - 1) * W;
    const y = H - v * H * 0.88;
    i === 0 ? ctx.lineTo(x, y) : ctx.lineTo(x, y);
  });
  ctx.lineTo(W, H); ctx.closePath();
  ctx.fillStyle = g; ctx.fill();
}

// â”€â”€ Both tracks loaded â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkBoth() {
  if (!S.a || !S.b) return;
  document.getElementById('compatSection').style.display = 'block';
  document.getElementById('mixSection').style.display = 'block';
  renderCompat(S.a, S.b);
  document.getElementById('compatSection').classList.add('fade-up');
  document.getElementById('mixSection').classList.add('fade-up');
}

function renderCompat(a, b) {
  const bpmDiff = Math.abs(a.bpm - b.bpm);
  const bpmScore = bpmDiff === 0 ? 100 : bpmDiff <= 2 ? 95 : bpmDiff <= 5 ? 80 :
                   bpmDiff <= 10 ? 60 : bpmDiff <= 20 ? 35 : Math.max(0, 35 - (bpmDiff - 20));

  // Rough key score
  const sameKey = a.camelot === b.camelot;
  const keyScore = sameKey ? 100 : a.camelot.slice(-1) === b.camelot.slice(-1) ? 65 : 40;

  // Spectral score placeholder
  const specScore = 70;

  const overall = Math.round(bpmScore * 0.38 + keyScore * 0.45 + specScore * 0.17);
  const color = overall >= 85 ? '#00ff88' : overall >= 70 ? '#88ff00' :
                overall >= 50 ? '#ffdd00' : overall >= 30 ? '#ff8800' : '#ff2060';
  const verdict = overall >= 85 ? 'ğŸ¯ Perfect Conditions' : overall >= 70 ? 'âœ… Strong Mix' :
                  overall >= 50 ? 'âš¡ Workable â€” AI will adapt' :
                  overall >= 30 ? 'âš ï¸ Challenging â€” AI surgery needed' : 'âŒ High Clash â€” AI will bridge';

  const off = 251.2 - (overall/100) * 251.2;
  document.getElementById('ringFg').style.strokeDashoffset = off;
  document.getElementById('ringFg').style.stroke = color;
  document.getElementById('scoreNum').textContent = overall;
  document.getElementById('scoreNum').style.color = color;
  document.getElementById('verdict').textContent = verdict;
  document.getElementById('verdict').style.color = color;

  document.getElementById('barBpm').style.width = bpmScore + '%';
  document.getElementById('barBpmV').textContent = bpmScore + '%';
  document.getElementById('barKey').style.width = keyScore + '%';
  document.getElementById('barKeyV').textContent = keyScore + '%';
  document.getElementById('barSpec').style.width = specScore + '%';
  document.getElementById('barSpecV').textContent = specScore + '%';

  document.getElementById('bpmBridge').innerHTML =
    `<strong>${a.bpm} BPM Â· ${a.camelot}</strong> &nbsp;âŸ¶&nbsp; <strong>${b.bpm} BPM Â· ${b.camelot}</strong><br>` +
    `BPM Î”: ${bpmDiff.toFixed(1)} &nbsp;Â·&nbsp; Time-stretch ratio: Ã—${(b.bpm/a.bpm).toFixed(3)}`;
}

// â”€â”€ Mix â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function startMix() {
  if (!S.a || !S.b) { toast('âŒ Load both tracks first'); return; }
  const btn = document.getElementById('mixBtn');
  btn.disabled = true;
  document.getElementById('statusRow').classList.add('show');
  const logEl = document.getElementById('liveLog');
  logEl.classList.add('show');
  logEl.innerHTML = '';

  try {
    const res = await fetch('/api/mix', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ file_id_1: S.a.file_id, file_id_2: S.b.file_id })
    });
    const d = await res.json();
    if (d.job_id) {
      S.job = d.job_id;
      pollJob(d.job_id, btn, logEl);
    } else {
      toast('âŒ ' + (d.error || 'Mix failed'));
      btn.disabled = false;
      document.getElementById('statusRow').classList.remove('show');
    }
  } catch(e) {
    toast('âŒ ' + e.message);
    btn.disabled = false;
    document.getElementById('statusRow').classList.remove('show');
  }
}

let lastLogLen = 0;
function pollJob(id, btn, logEl) {
  S.poll = setInterval(async () => {
    try {
      const res = await fetch('/api/job/' + id);
      const d = await res.json();
      const prog = d.progress || d.status;
      document.getElementById('statusTxt').textContent = prog;

      // Append new log lines
      const log = d.log || [];
      if (log.length > lastLogLen) {
        for (let i = lastLogLen; i < log.length; i++) {
          const line = document.createElement('div');
          line.className = 'log-line' + (i === log.length - 1 ? ' new' : '');
          line.textContent = log[i];
          logEl.appendChild(line);
        }
        logEl.scrollTop = logEl.scrollHeight;
        lastLogLen = log.length;
      }

      if (d.status === 'done') {
        clearInterval(S.poll); lastLogLen = 0;
        btn.disabled = false;
        document.getElementById('statusRow').classList.remove('show');
        onMixDone(d);
      } else if (d.status === 'error') {
        clearInterval(S.poll); lastLogLen = 0;
        btn.disabled = false;
        document.getElementById('statusRow').classList.remove('show');
        toast('âŒ ' + d.error);
      }
    } catch(e) { /* network blip */ }
  }, 800);
}

function onMixDone(d) {
  console.log('[MiXL] onMixDone received:', JSON.stringify(d).slice(0, 300));

  const r = d.result;
  if (!r) {
    toast('âŒ Mix result missing â€” check server console');
    console.error('[MiXL] d.result is undefined. Full response:', d);
    return;
  }

  // Safe fallback for strategy_info (may be nested differently)
  const si = r.strategy_info || {
    icon: 'ğŸ›ï¸',
    name: r.strategy || 'Auto',
    description: 'AI-selected transition technique',
    color: '#00e5ff'
  };

  // â”€â”€ Strategy panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ss = document.getElementById('strategySection');
  ss.style.display = 'block';
  ss.classList.add('fade-up');

  document.getElementById('stratIcon').textContent = si.icon || 'ğŸ›ï¸';
  document.getElementById('stratName').textContent = si.name || r.strategy || 'â€”';
  document.getElementById('stratDesc').textContent = si.description || '';
  document.getElementById('stratName').style.color  = si.color || '#00e5ff';

  // â”€â”€ Modifications tags â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const mr = document.getElementById('modsRow');
  mr.innerHTML = '';
  (r.modifications || []).forEach(m => {
    const tag = document.createElement('div');
    tag.className = 'mod-tag';
    tag.textContent = m.replace(/_/g, ' ');
    mr.appendChild(tag);
  });

  // â”€â”€ Reasoning chain â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const rl = document.getElementById('reasonList');
  rl.innerHTML = '';
  const reasoning = r.reasoning || [];
  if (reasoning.length === 0) {
    rl.innerHTML = '<div class="reason-item"><span class="reason-arrow">â†’</span><span>Strategy selected based on BPM and harmonic analysis</span></div>';
  } else {
    reasoning.forEach((line, i) => {
      const item = document.createElement('div');
      item.className = 'reason-item' + (i < 2 ? ' highlight' : '');
      item.innerHTML = '<span class="reason-arrow">â†’</span><span>' + line + '</span>';
      rl.appendChild(item);
    });
  }

  // â”€â”€ Execution log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const execLog = r.execution_log || [];
  if (execLog.length > 0) {
    document.getElementById('execLogSection').style.display = 'block';
    document.getElementById('execLogScroll').innerHTML =
      execLog.map(l => '<div class="exec-line">' + l + '</div>').join('');
  }

  // â”€â”€ Player â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ps = document.getElementById('playerSection');
  ps.style.display = 'block';
  ps.classList.add('fade-up');

  const outputUrl = d.output_url || r.output_url || '';
  const audio = document.getElementById('audio');
  audio.src = outputUrl;

  const t1name = (r.track1 && r.track1.filename) ? r.track1.filename : 'Track A';
  const t2name = (r.track2 && r.track2.filename) ? r.track2.filename : 'Track B';
  document.getElementById('playerTitle').textContent =
    t1name + '  âœ•  ' + t2name + '  Â·  ' + si.icon + ' ' + si.name;

  const dlBtn = document.getElementById('dlBtn');
  dlBtn.href = outputUrl;
  dlBtn.download = 'MiXL_' + (r.strategy || 'mix') + '.wav';

  audio.addEventListener('loadedmetadata', () => {
    document.getElementById('totTime').textContent = fmt(audio.duration);
  }, { once: true });

  // Set volume on new audio src
  audio.volume = volLevel;

  // â”€â”€ Result metrics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const c = r.compatibility || {};
  const dur = r.mix_duration_sec ? fmt(r.mix_duration_sec) : 'â€”';
  const ratio = r.bpm_ratio_applied || 'â€”';
  document.getElementById('resultGrid').innerHTML =
    '<div class="metric"><div class="metric-lbl">Duration</div><div class="metric-val">' + dur + '</div><div class="metric-sub">Total output</div></div>' +
    '<div class="metric"><div class="metric-lbl">Strategy</div><div class="metric-val" style="font-size:.72rem;color:' + (si.color||'#00e5ff') + '">' + si.icon + ' ' + si.name + '</div><div class="metric-sub">Technique used</div></div>' +
    '<div class="metric"><div class="metric-lbl">Score</div><div class="metric-val" style="color:' + (c.verdict_color||'#00ff88') + '">' + (c.overall||'â€”') + '%</div><div class="metric-sub">' + (c.verdict||'') + '</div></div>' +
    '<div class="metric"><div class="metric-lbl">BPM Stretch</div><div class="metric-val" style="font-size:.9rem">Ã—' + ratio + '</div><div class="metric-sub">Applied to Track B</div></div>';

  toast('ğŸµ Mix ready â€” ' + si.icon + ' ' + si.name);
  ps.scrollIntoView({ behavior: 'smooth' });
}

// â”€â”€ Audio Player â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let playing = false;
function togglePlay() {
  const a = document.getElementById('audio');
  if (playing) { a.pause(); document.getElementById('playBtn').textContent = 'â–¶'; playing = false; }
  else { a.play(); document.getElementById('playBtn').textContent = 'â¸'; playing = true; }
}
function onTime() {
  const a = document.getElementById('audio');
  if (!a.duration) return;
  document.getElementById('progFill').style.width = (a.currentTime / a.duration * 100) + '%';
  document.getElementById('curTime').textContent = fmt(a.currentTime);
}
function onEnded() {
  document.getElementById('playBtn').textContent = 'â–¶';
  document.getElementById('progFill').style.width = '0%';
  playing = false;
}
function seek(e) {
  const a = document.getElementById('audio');
  if (!a.duration) return;
  const b = document.getElementById('progBar').getBoundingClientRect();
  a.currentTime = ((e.clientX - b.left) / b.width) * a.duration;
}

// â”€â”€ Volume Control â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let volLevel = 0.8;
let prevVol  = 0.8;
let muted    = false;

function setVolume(pct) {
  pct = Math.max(0, Math.min(1, pct));
  volLevel = pct;
  muted = pct === 0;

  const audio = document.getElementById('audio');
  audio.volume = pct;

  document.getElementById('volFill').style.width  = (pct * 100) + '%';
  document.getElementById('volThumb').style.left  = (pct * 100) + '%';
  document.getElementById('volPct').textContent    = Math.round(pct * 100) + '%';

  const icon = document.getElementById('volIcon');
  if (pct === 0)       icon.textContent = 'ğŸ”‡';
  else if (pct < 0.35) icon.textContent = 'ğŸ”ˆ';
  else if (pct < 0.7)  icon.textContent = 'ğŸ”‰';
  else                 icon.textContent = 'ğŸ”Š';

  const fill = document.getElementById('volFill');
  if (pct > 0.66)      fill.style.background = 'linear-gradient(90deg, var(--accent3), var(--accent1))';
  else if (pct > 0.33) fill.style.background = 'linear-gradient(90deg, var(--accent2), var(--accent3))';
  else                 fill.style.background = 'linear-gradient(90deg, var(--muted), var(--accent2))';
}

function toggleMute() {
  if (muted) { setVolume(prevVol || 0.8); muted = false; }
  else { prevVol = volLevel; setVolume(0); muted = true; }
}

(function initVolumeDrag() {
  const track = document.getElementById('volTrack');
  if (!track) return;
  let dragging = false;

  function getPct(e) {
    const r = track.getBoundingClientRect();
    return Math.max(0, Math.min(1, (e.clientX - r.left) / r.width));
  }
  track.addEventListener('mousedown', e => { dragging = true; setVolume(getPct(e)); e.preventDefault(); });
  document.addEventListener('mousemove', e => { if (dragging) setVolume(getPct(e)); });
  document.addEventListener('mouseup', () => { dragging = false; });

  track.addEventListener('touchstart', e => { dragging = true; setVolume(getPct(e.touches[0])); e.preventDefault(); }, { passive: false });
  document.addEventListener('touchmove', e => { if (dragging) setVolume(getPct(e.touches[0])); });
  document.addEventListener('touchend', () => { dragging = false; });

  track.addEventListener('wheel', e => { e.preventDefault(); setVolume(volLevel - e.deltaY * 0.001); }, { passive: false });
})();

window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('audio').volume = volLevel;
});


// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmt(s) {
  const t = Math.floor(s);
  return Math.floor(t/60) + ':' + String(t%60).padStart(2,'0');
}
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 4000);
}
</script>
</body>
</html>